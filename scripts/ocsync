# Runs a persistent rsync to copy changed files to the current pod running
# the specified application in your current open shift project. If your pod
# dies, you'll need to rerun this command.
# Usage:
#   ocsync <targetdir>
# Example:
#   ocsync railsapi ..
targetdir=$1
apppodname=`oc get pods -l app=railsapp | grep Running | awk '{print $1}'`
solrpodname=`oc get pods -l app=solr | grep Running | awk '{print $1}'`

# Sync solr configs
oc exec -it $solrpodname -- bash -c "mkdir -p /opt/solr/server/solr/mycores/hyrax"
oc rsync $targetdir/solr/config/ $solrpodname:/opt/solr/server/solr/mycores/hyrax/
oc exec -it $solrpodname -- bash -c "chmod -R 777 /opt/solr/server/solr/mycores/*"


oc rsync "$targetdir" $apppodname:/opt/app-root/src --no-perms=true --watch
